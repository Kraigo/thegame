"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var _createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),Basis=function(){function e(t,i){_classCallCheck(this,e),i=i||{},this.game=t,this.screen=t.screen,this.stage=t.stage,this.view=Object.assign({width:16,height:16,x:0,y:0,get cx(){return this.x+this.width/2},get cy(){return this.y+this.height/2}},i.view),this.cy=this.collider=null,this.direction={x:0,y:0},this.look={x:0,y:0},this.lookAngel=90,this.speed=0,this.velocity=0,this.gravity=.5,this.animation={name:null,state:"stand",keyframe:0,rate:5,end:!1},this.health={max:100,current:100},this.attack={damageMin:1,damageMax:2,range:0},this.willDie=!1,this.willAttack=!1,this.rotationSpeed=.05,this.density=0,this.bonuses=[],this.contacts=[]}return _createClass(e,[{key:"render",value:function(){this.game.screen.beginPath(),this.game.screen.rect(this.view.x-this.game.camera.x,this.view.y-this.game.camera.y,this.view.width,this.view.height),this.game.screen.stroke()}},{key:"renderDebug",value:function(){this.game.screen.beginPath(),this.game.screen.strokeStyle="green",this.game.screen.rect(this.view.x-this.game.camera.x,this.view.y-this.game.camera.y,this.view.width,this.view.height),this.game.screen.stroke(),this.collider&&(this.game.screen.beginPath(),this.game.screen.strokeStyle="purple",this.game.screen.arc(this.collider.pos.x-this.game.camera.x,this.collider.pos.y-this.game.camera.y,this.collider.r,0,2*Math.PI),this.game.screen.stroke())}},{key:"healthBar",value:function t(){var t={x:this.view.x-this.game.camera.x,y:this.view.y-this.game.camera.y-5,height:3,width:this.view.width*(this.health.current/this.health.max)};this.game.screen.beginPath(),this.game.screen.fillStyle="red",this.game.screen.strokeStyle="red",this.game.screen.rect(t.x,t.y,this.view.width,t.height),this.game.screen.fillRect(t.x,t.y,t.width,t.height),this.game.screen.stroke()}},{key:"update",value:function(){}},{key:"onEnter",value:function(){}},{key:"onLeave",value:function(){}},{key:"onDie",value:function(){}},{key:"createCollider",value:function(){var e=this.collider&&this.collider.x||this.view.x+this.view.width/2,t=this.collider&&this.collider.y||this.view.y+this.view.height/2,i=this.collider&&this.collider.r||this.view.width/2;this.collider=new SAT.Circle(new SAT.Vector(e,t),i)}},{key:"addBonus",value:function(e){var t=this;e instanceof Bonus&&e.canApply(this)&&(e.make(this,e.effect),e.permanent||(this.bonuses.push(e),e.time&&setTimeout(function(){t.removeBonus(e)},e.time)))}},{key:"removeBonus",value:function(e){e.make(this,e.effect,!0),this.bonuses.splice(this.bonuses.indexOf(e),1)}},{key:"colliding",value:function(e,t){var i=e.x-t.x,n=e.y-t.y,s=Math.sqrt(i*i+n*n);return s<e.r+t.r}},{key:"collidingView",value:function(e){return e.width=e.width||0,e.height=e.height||0,!(this.view.x+this.view.width<e.x||this.view.y+this.view.height<e.y||this.view.x>e.x+e.width||this.view.y>e.y+e.height)}},{key:"collidingBody",value:function(e){return this!=e&&this.colliding({x:this.view.x,y:this.view.y,r:this.view.width/2},{x:e.view.x,y:e.view.y,r:e.view.width/2})}},{key:"isOuterCamera",value:function(){return!this.collidingView(this.view)}},{key:"directionTo",value:function(e){var t=e.x+e.width/2-(this.view.x+this.view.width/2),i=e.y+e.height/2-(this.view.y+this.view.height/2),n=Math.sqrt(t*t+i*i);return{x:t/n,y:i/n}}},{key:"vectorAngle",value:function(e,t){Math.atan2(t.y-e.y,t.x-e.x);return 180*Math.atan2(t.y-e.y,t.x-e.x)/Math.PI}},{key:"getRandomInt",value:function(e,t){return e=e||0,Math.floor(Math.random()*(t-e+1))+e}},{key:"changeAnimation",value:function(e){this.animation.state!=e&&(this.animation.state=e,this.animation.keyframe=0,this.animation.end=!1)}},{key:"kill",value:function(){this.willDie=!0,this.health.current=0,this.changeAnimation("die")}},{key:"hit",value:function(e){this.health.current-=e,this.health.current<=0&&(this.health.current=0)}},{key:"heal",value:function(e){this.health.current+=e,this.health.current>this.health.max&&(this.health.current=this.health.max)}},{key:"isReach",value:function(e){return this!=e&&this.colliding({x:this.view.x,y:this.view.y,r:this.view.width/2},{x:e.view.x,y:e.view.y,r:this.attack.range+this.view.width/2})}},{key:"stepMove",value:function(e,t){this.view.x+=e,this.view.y+=t,this.collider&&(this.collider.pos.x+=e,this.collider.pos.y+=t)}},{key:"teleport",value:function(e,t){this.view.x=e,this.view.y=t,this.collider&&(this.collider.pos.x=e+this.view.width/2,this.collider.pos.y=t+this.view.width/2)}},{key:"faceBarrier",value:function(){for(var e,t=new SAT.Response,i=0;i<this.game.stage.levelSolid.length;i++){t.clear(),e=this.game.stage.levelSolid[i],e instanceof SAT.Box&&(e=e.toPolygon());var n=SAT.testCirclePolygon(this.collider,e,t);if(n&&t.overlap)return{collided:n,response:t,barrier:e}}}},{key:"faceBodies",value:function(){for(var e,t=new SAT.Response,i=[],n=0;n<this.game.bodies.length;n++)if(e=this.game.bodies[n],this!=e&&e.collider){t.clear();var s=SAT.testCircleCircle(this.collider,e.collider,t);s&&t.overlap&&i.push({collided:s,response:t,body:e})}return i}},{key:"fixStuck",value:function(){var e=this.faceBarrier();e&&(e.response.overlapV.reverse(),this.stepMove(e.response.overlapV.x,e.response.overlapV.y))}},{key:"faceContacts",value:function(){for(var e=this.faceBodies(),t=0;t<e.length;t++)e[t].body.willDie||e[t].body.onEnter(this,e[t].response);for(var i=this.contacts.filter(function(t){return!e.some(function(e){return e.body==t})}),t=0;t<i.length;t++)i[t].onLeave(this);return this.contacts=e.map(function(e){return e.body}),this.contacts}}]),e}(),_createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),Unit=function(e){function t(e,i){_classCallCheck(this,t),i=i||{};var n=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e,i));return n.id=null,n.speed=3,n.index=1,n.health.current=90,n.shooting={start:!1,bullet:1,rate:3,reload:0},n.attack={damageMin:5,damageMax:10,range:10},n.animation.name="player",n}return _inherits(t,e),_createClass(t,[{key:"update",value:function(){this.shot(),this.move(),this.faceContacts()}},{key:"move",value:function(){this.direction.x||this.direction.y?(this.stepMove(this.direction.x*this.speed,this.direction.y*this.speed),this.changeAnimation("walk")):this.changeAnimation("stand"),this.fixStuck()}},{key:"shot",value:function(){if(!this.shooting.bullet&&++this.shooting.reload>=60/this.shooting.rate&&(this.shooting.bullet=1,this.shooting.reload=0),this.shooting.bullet&&this.shooting.start){this.shooting.bullet=0;var e={x:this.view.x+this.view.width/2,y:this.view.y+this.view.height/2,direction:this.directionTo({x:this.game.mouse.x+this.game.camera.x,y:this.game.mouse.y+this.game.camera.y,width:0,height:0}),damage:this.getRandomInt(this.attack.damageMin,this.attack.damageMax),owner:this.game.player},t=new Bullet(this.game,e);this.game.addBody(t)}}}]),t}(Basis),_createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),Asteroid=function(e){function t(e,i){_classCallCheck(this,t);var n=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e,i));return n.direction={x:Math.random(),y:Math.random()},n.attack.range=5,n.view.width=48,n.view.height=48,n.speed=2*Math.random(),n.speed=2,n.animation.name="monster",n.target=i.target||null,n.density=.03,n.path=[],n.createCollider(),n}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){this.game.screen.beginPath(),this.game.screen.arc(this.view.x+this.view.width/2-this.game.camera.x,this.view.y+this.view.height/2-this.game.camera.y,(this.view.width+this.view.height)/6,0,2*Math.PI),this.game.screen.fillStyle="rgba(0,0,0,0.2)",this.game.screen.fill();var e=this.vectorAngle({x:this.view.x-this.game.camera.x,y:this.view.y-this.game.camera.y},{x:this.view.x-this.game.camera.x+this.look.x,y:this.view.y-this.game.camera.y+this.look.y});this.game.sprite.draw(this,e),this.healthBar(),this.game.debug&&this.renderPath()}},{key:"update",value:function(){if(this.target){if(this.path=this.game.stage.path(this,this.target),this.path.length)for(var e,t=0;t<this.path.length;t++)if(e=this.path[t],!this.collidingView(e)){this.direction=this.directionTo(e),this.move(),this.routeTo(e);break}}else this.path=[];this.faceContacts(),this.willAttack||this.isReach(this.target)?(this.willAttack=!0,this.changeAnimation("attack"),this.animation.end&&(this.willAttack=!1,this.isReach(this.target)&&(console.log("hit you"),this.target.hit(this.getRandomInt(this.attack.damageMin,this.attack.damageMax))),this.changeAnimation("stand"))):this.speed?this.changeAnimation("walk"):this.changeAnimation("stand")}},{key:"routeTo",value:function(e){var t=this.directionTo(e);this.look.x+=(t.x-this.look.x)*this.rotationSpeed,this.look.y+=(t.y-this.look.y)*this.rotationSpeed}},{key:"routeToTarget",value:function(){var e=this.directionTo(_defineProperty({view:{x:this.target.view.x,y:this.target.view.y}},"view",{width:this.view.width,height:this.view.height}));this.direction.x+=(e.x-this.direction.x)*this.rotationSpeed,this.direction.y+=(e.y-this.direction.y)*this.rotationSpeed,this.look.x+=(e.x-this.look.x)*this.rotationSpeed,this.look.y+=(e.y-this.look.y)*this.rotationSpeed}},{key:"renderPath",value:function(){if(this.path.length){this.game.screen.strokeStyle="yellow",this.game.screen.beginPath();for(var e=0;e<this.path.length;e++){var t=this.path[e].x-this.game.camera.x,i=this.path[e].y-this.game.camera.y;0===e?this.game.screen.moveTo(t,i):this.game.screen.lineTo(t,i)}this.screen.stroke()}}}]),t}(Unit),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},_createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),Bonus=function(e){function t(e,i){_classCallCheck(this,t),i=i||{};var n=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e,i));return n.bonus=i.bonus,n.time=1e3,n.view.width=24,n.view.height=24,n.effect=null,n.permanent=!1,n.createCollider(),n}return _inherits(t,e),_createClass(t,[{key:"make",value:function(e,t,i){if(t)for(var n in t){var s=t[n];switch("undefined"==typeof s?"undefined":_typeof(s)){case"boolean":e[n]=i?s:!s;break;case"number":e[n]+=i?-s:s;break;case"object":this.make(e[n],s,i)}}}},{key:"canApply",value:function(){return!0}},{key:"onEnter",value:function(e){var t=this;e instanceof Player&&!e.bonuses.some(function(e){return e.constructor.name===t.constructor.name})&&this.canApply(e)&&(e.addBonus(this),this.game.removeBody(this))}}]),t}(Basis),_createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),Builder=function(e){function t(e){_classCallCheck(this,t);var i=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e));return i.game=e,i.view={width:24,height:24,x:0,y:0,sx:0,sy:0},i.speed=3,i.material={sx:0,sy:0},i.addActivity(),i}return _inherits(t,e),_createClass(t,[{key:"update",value:function(){this.view.sx=this.game.mouse.x+this.game.camera.x-(this.game.mouse.x+this.game.camera.x)%this.view.width,this.view.sy=this.game.mouse.y+this.game.camera.y-(this.game.mouse.y+this.game.camera.y)%this.view.width,this.move()}},{key:"render",value:function(){this.game.screen.beginPath(),this.game.screen.strokeStyle="black",this.game.screen.rect(this.view.sx-this.game.camera.x,this.view.sy-this.game.camera.y,this.view.width,this.view.height),this.game.screen.stroke(),this.game.screen.beginPath(),this.game.screen.fillStyle="white",this.game.screen.fillRect(this.game.camera.width-240,this.game.camera.height-360,240,360),this.game.screen.stroke(),this.game.screen.drawImage(this.game.stage.image,0,0,240,360,this.game.camera.width-240,this.game.camera.height-360,240,360),this.game.screen.beginPath(),this.game.screen.strokeStyle="red",this.game.screen.rect(this.game.camera.width-240+this.material.sx,this.game.camera.height-360+this.material.sy,this.view.width,this.view.height),this.game.screen.stroke()}},{key:"move",value:function(){this.view.sx,this.view.sy;this.game.keyboard.isPressed("A")?this.view.x-=this.speed:this.game.keyboard.isPressed("D")&&(this.view.x+=this.speed),this.game.keyboard.isPressed("W")?this.view.y-=this.speed:this.game.keyboard.isPressed("S")&&(this.view.y+=this.speed)}},{key:"addActivity",value:function(){var e=this,t=this.game.keyboard,i=this.game;document.addEventListener("mousedown",function(t){if(t.x>i.camera.width-240&&t.y>i.camera.height-360){var n=t.x-(i.camera.width-240),s=t.y-(i.camera.height-360);n-=n%e.view.width,s-=s%e.view.height,e.material.sx=n,e.material.sy=s,console.log(e.material.sx,e.material.sy)}else e.game.stage.build({x:e.view.sx,y:e.view.sy,sx:e.material.sx,sy:e.material.sy})}),document.addEventListener("keydown",function(i){t.isClicked("SPACE",i.keyCode)&&e.game.stage.addSolid(e.view.sx,e.view.sy,24,24),t.isClicked("C",i.keyCode)&&e.game.stage.clean(),t.isClicked("R",i.keyCode)&&e.game.stage.remove(e.view.sx,e.view.sy),t.isClicked("1",i.keyCode)&&e.game.stage.simplifySolid(),t.isClicked("F3",i.keyCode)&&e.game.stage.logLevel(),t.isClicked("F4",i.keyCode)&&e.game.stage.loadLevel("1")})}}]),t}(Basis),_createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),Bullet=function(e){function t(e,i){_classCallCheck(this,t);var n=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e,i));return n.view.width=24,n.view.height=24,n.view.x=i.x-n.view.width/2,n.view.y=i.y-n.view.height/2,n.direction=i.direction,n.speed=5,n.animation.name="bullet",n.attack.damage=i.damage,n.attack.damage=10,n.owner=i.owner,n.timer=n.game.timer,n.createCollider(),n}return _inherits(t,e),_createClass(t,[{key:"update",value:function(){this.isOuterCamera()&&this.game.removeBody(this),this.faceContacts(),this.stepMove(this.direction.x*this.speed,this.direction.y*this.speed);var e=this.faceBarrier();if(e){console.log(this.direction),console.log(e.response.overlapN);var t=e.response.overlapN;0!=t.x&&(this.direction.x=-this.direction.x),0!=t.y&&(this.direction.y=-this.direction.y),this.kill(),this.speed=0}else this.game.timer>this.timer+100&&(this.kill(),this.speed=0)}},{key:"render",value:function(){var e=this.vectorAngle({x:this.view.x-this.game.camera.x,y:this.view.y-this.game.camera.y},{x:this.view.x-this.game.camera.x+this.direction.x*this.speed,y:this.view.y-this.game.camera.y+this.direction.y*this.speed});this.game.sprite.draw(this,e)}},{key:"onEnter",value:function(e){e instanceof Unit&&e!=this.owner&&(e.hit(this.attack.damage),this.kill(),this.speed=0)}}]),t}(Basis),_createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),Camera=function(){function e(t){_classCallCheck(this,e),this.game=t,this.x=0,this.y=0,this.width=t.canvas.width,this.height=t.canvas.height,this.target=null,this.stretch=.2}return _createClass(e,[{key:"setTarget",value:function(e){this.target=e}},{key:"isCameraShow",value:function(e){return!(e.view.x+e.view.width<this.x&&e.view.x>this.width&&e.view.y+e.view.height<this.y&&e.view.y>this.width)}},{key:"update",value:function(){this.x=this.target.view.x-this.width/2+this.target.view.width/2,this.y=this.target.view.y-this.height/2+this.target.view.height/2,this.x+=(this.game.mouse.x-this.width/2)*this.stretch,this.y+=(this.game.mouse.y-this.height/2)*this.stretch}}]),e}(),_createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),Game=function(){function Game(){_classCallCheck(this,Game);var e=this;this.editMode=!1,this.canvas=document.createElement("canvas"),document.body.appendChild(this.canvas),this.canvas.width=document.body.offsetWidth-10,this.canvas.height=document.body.offsetHeight-10,this.bodies=[],this.debug=!1,this.screen=this.canvas.getContext("2d"),this.screen.imageSmoothingEnabled=!1,this.camera=new Camera(e),this.world={width:792,height:792},this.player=new Player(e,{view:{x:300,y:300,width:48,height:48}}),this.playerControl=new PlayerControl(e),this.builder=null,this.keyboard=new Keyboard,this.mouse=new Mouse(e.canvas),this.sprite=new Sprite(e),this.stage=new Stage(e),this.lastTick=new Date,this.timer=0,this.camera.setTarget(this.player),this.addBody(this.player);for(var t=0;0>t;t++)e.addBody(new Asteroid(e,{target:e.player,view:{width:48,height:48,x:450,y:500}}));var i=function n(){e.update(),e.render(),requestAnimationFrame(n)};i(),this.modeToggler()}return _createClass(Game,[{key:"render",value:function(){this.screen.clearRect(0,0,this.camera.width,this.camera.height);var e=new Date,t=Math.round(1e3/(e-this.lastTick));this.lastTick=e,this.stage.render(),this.drawDebug(["FPS: "+t,"Obj count: "+this.bodies.length,"Stage count: "+this.stage.level.length,"Camera (x: "+this.camera.x.toFixed()+", y: "+this.camera.y.toFixed()+")","Player (x: "+this.player.view.x.toFixed()+", y: "+this.player.view.y.toFixed()+")","Player dir(x: "+this.player.direction.x+", y: "+this.player.direction.y+")","Bonuses ["+this.player.bonuses.map(function(e){return e.title}).join(", ")+"]"]),this.drawUI(),this.screen.rect(0-this.camera.x,0-this.camera.y,this.world.width,this.world.height),this.screen.stroke();for(var i,n=0;n<this.bodies.length;n++)i=this.bodies[n],this.camera.isCameraShow(i)&&i.render(),this.debug&&i.renderDebug()}},{key:"update",value:function(){this.timer++,this.camera.update(),this.playerControl.update();for(var e,t=0;t<this.bodies.length;t++)e=this.bodies[t],!e.willDie&&0!==e.health.current||!e.animation.end?e.willDie?(e.speed=0,e.direction.x=0,e.direction.y=0):e.update():(this.removeBody(e),t--)}},{key:"addBody",value:function(e){this.bodies.push(e),this.bodies.sort(function(e){return e.index})}},{key:"removeBody",value:function(e){this.bodies.splice(this.bodies.indexOf(e),1)}},{key:"drawDebug",value:function(e){this.screen.fillStyle="orange";for(var t=0;t<e.length;t++)this.screen.fillText(e[t],10,18*(t+1))}},{key:"drawUI",value:function(){this.screen.fillStyle="black",this.screen.strokeStyle="black",this.screen.fillText("W",40,this.camera.height-40),this.screen.fillText("S",40,this.camera.height-20),this.screen.fillText("A",20,this.camera.height-20),this.screen.fillText("D",60,this.camera.height-20),this.screen.beginPath(),this.screen.moveTo(35,this.camera.height-55),this.screen.lineTo(55,this.camera.height-55),this.screen.lineTo(55,this.camera.height-35),this.screen.lineTo(75,this.camera.height-35),this.screen.lineTo(75,this.camera.height-15),this.screen.lineTo(15,this.camera.height-15),this.screen.lineTo(15,this.camera.height-35),this.screen.lineTo(35,this.camera.height-35),this.screen.lineTo(35,this.camera.height-55),this.screen.stroke()}},{key:"modeToggler",value:function(){var e=this;document.addEventListener("keydown",function(t){113==t.keyCode&&(e.builder=new Builder(e),e.camera.target=e.builder,e.camera.stretch=0,e.bodies=[],e.addBody(e.builder))})}},{key:"evalBody",value:function evalBody(modelName,params){var model=eval(modelName);return new model(this,params)}}]),Game}(),Keyboard=function e(){_classCallCheck(this,e);var t={},i={SPACE:32,A:65,W:87,D:68,S:83,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,F:70,G:71,H:72,C:67,R:82,F2:113,F3:114,F4:115,F5:116,LEFT:37,UP:38,RIGHT:39,DOWN:40};document.addEventListener("keydown",function(e){e.preventDefault(),t[e.keyCode]=!0}),document.addEventListener("keyup",function(e){t[e.keyCode]=!1}),this.isPressed=function(e){return e=e.toUpperCase(),t[i[e]]},this.isClicked=function(e,t){return i[e]===t},this.keyCode=function(e){return e=e.toUpperCase(),i[e]}},Mouse=function t(e){_classCallCheck(this,t);var i=this,n={},s={LEFT:0,RIGHT:2,MIDDLE:1};this.x=0,this.y=0,e.addEventListener("mousemove",function(e){i.x=e.clientX,i.y=e.clientY}),e.addEventListener("mousedown",function(e){e.preventDefault(),n[e.button]=!0}),e.addEventListener("mouseup",function(e){e.preventDefault(),n[e.button]=!1}),this.isPressed=function(e){return e=e.toUpperCase(),n[s[e]]}},_createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),Player=function(e){function t(e,i){_classCallCheck(this,t);var n=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e,i));return n.createCollider(),n}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){this.game.screen.beginPath(),this.game.screen.arc(this.view.x+this.view.width/2-this.game.camera.x,this.view.y+this.view.height/2-this.game.camera.y,(this.view.width+this.view.height)/6,0,2*Math.PI),this.game.screen.fillStyle="rgba(0,0,0,0.2)",this.game.screen.fill(),this.game.sprite.draw(this,this.lookAngel),this.healthBar()}}]),t}(Unit),_createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),PlayerControl=function(){function e(t){_classCallCheck(this,e),this.game=t}return _createClass(e,[{key:"update",value:function(){this.move(),this.shot(),this.rotate()}},{key:"move",value:function(){var e=this.game.player;e.direction.x=0,e.direction.y=0,this.game.keyboard.isPressed("A")?e.direction.x=-1:this.game.keyboard.isPressed("D")&&(e.direction.x=1),this.game.keyboard.isPressed("W")?e.direction.y=-1:this.game.keyboard.isPressed("S")&&(e.direction.y=1)}},{key:"shot",value:function(){this.game.player.shooting.start=this.game.mouse.isPressed("LEFT")||this.game.keyboard.isPressed("SPACE")}},{key:"rotate",value:function(){this.game.player.lookAngel=this.game.player.vectorAngle({x:this.game.player.view.x-this.game.camera.x+this.game.player.view.width/2,y:this.game.player.view.y-this.game.camera.y+this.game.player.view.width/2},{x:this.game.mouse.x,y:this.game.mouse.y})}}]),e}(),_createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),Socket=function(){function e(t){function i(e){t.player.id=e.socketId;for(var i=0;i<e.game.length;i++)e.socketId===e.game[i].socketId?(t.player.id=e.socketId,t.player.position=e.game[i].position):a(e.game[i]);h.move(t.player)}function n(e){c[e.socketId]&&(c[e.socketId].willDie=!0,delete c[e.socketId])}function s(e){c[e.socketId]||a(e),c[e.socketId].position=e.position,c[e.socketId].lookAngel=e.lookAngel,c[e.socketId].direction=e.direction}function a(e){var i=new Player(t,e.position);c[e.socketId]=i,c[e.socketId].id=e.socketId,c[e.socketId].lookAngel=e.lookAngel,t.bodies.push(i)}function r(e){t.addBody(new Bullet(t,e.bullet,c[e.socketId]));
}function o(e){t.player.id==e.socketId&&t.player&&t.player.kill(),c[e.socketId]&&c[e.socketId].kill()}_classCallCheck(this,e);var h=this,l=io.connect();this.socket=l;var c={};l.on("connected",i),l.on("leave",n),l.on("move",s),l.on("join",a),l.on("bullet",r),l.on("kill",o)}return _createClass(e,[{key:"move",value:function(e){this.socket.emit("move",{position:e.position,lookAngel:e.lookAngel,direction:e.direction})}},{key:"shot",value:function(e){this.socket.emit("bullet",e)}},{key:"kill",value:function(e){this.socket.emit("kill",e)}}]),e}(),_createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),Spawn=function(e){function t(e,i){_classCallCheck(this,t);var n=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e,i));return n.populationModel=i.populationModel,n.populationParams=i.populationParams,n.time=i.time||1e3,n.interval=null,n.child=null,n.startInterval(),n}return _inherits(t,e),_createClass(t,[{key:"spawnItem",value:function(){var e=this.game.evalBody(this.populationModel,this.populationParams);e.view.x=this.view.x,e.view.y=this.view.y,e.createCollider(),this.child=e,this.game.addBody(e)}},{key:"onLeave",value:function(){}},{key:"onDie",value:function(){clearIntervat(this.interval)}},{key:"startInterval",value:function(){var e=this;this.interval=setInterval(function(){e.game.bodies.indexOf(e.child)<0&&e.spawnItem()},this.time)}}]),t}(Basis),_createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),Sprite=function(){function e(t){_classCallCheck(this,e),this.game=t,this.dir="/sprites/sprite.png",this.image=new Image,this.image.src=this.dir,this.view={width:48,height:48},this.collection={player:{stand:[{x:0,y:0}],walk:[{x:0,y:0},{x:48,y:0},{x:96,y:0},{x:144,y:0},{x:0,y:48},{x:48,y:48},{x:96,y:48},{x:144,y:48}],die:[{x:0,y:336},{x:0,y:336},{x:48,y:336},{x:48,y:336}]},monster:{stand:[{x:0,y:144}],walk:[{x:0,y:144},{x:48,y:144},{x:96,y:144},{x:144,y:144},{x:0,y:192},{x:48,y:192},{x:96,y:192},{x:144,y:192}],bite:[{x:0,y:240},{x:48,y:240},{x:96,y:240}],attack:[{x:0,y:288},{x:48,y:288},{x:96,y:288},{x:144,y:288},{x:192,y:288}],die:[{x:0,y:336},{x:0,y:336},{x:48,y:336},{x:48,y:336}]},bullet:{stand:[{x:0,y:96,w:24,h:24}],die:[{x:0,y:120,w:24,h:24},{x:24,y:120,w:24,h:24}]},teleport:{stand:[{x:0,y:384,w:52,h:52},{x:52,y:384,w:52,h:52},{x:104,y:384,w:52,h:52}]},bonusSpeed:{stand:[{x:0,y:436,w:48,h:48}]},bonusHealth:{stand:[{x:48,y:436,w:48,h:48}]},bonusAmmo:{stand:[{x:96,y:436,w:48,h:48}]},bonusFire:{stand:[{x:144,y:436,w:48,h:48}]}}}return _createClass(e,[{key:"draw",value:function(e,t){var i=e.view.x+e.view.width/2-this.game.camera.x,n=e.view.y+e.view.height/2-this.game.camera.y;t-=90;var s=this.getFrame(e.animation);this.game.screen.save(),this.game.screen.translate(i,n),this.game.screen.rotate(t*Math.PI/180),this.game.screen.drawImage(this.image,s.x,s.y,s.w||this.view.width,s.h||this.view.height,-e.view.width/2,-e.view.width/2,e.view.width,e.view.height),this.game.screen.translate(-i,-n),this.game.screen.rotate(-t*Math.PI/180),this.game.screen.restore()}},{key:"getFrame",value:function(e){var t=this.collection[e.name][e.state];return this.game.timer%e.rate==0&&(t.length-1>e.keyframe?e.keyframe+=1:(e.keyframe=0,e.end=!0)),t[e.keyframe]}}]),e}(),_createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),Stage=function(){function e(t){_classCallCheck(this,e);this.game=t,this.dir="/sprites/tileset.png",this.image=new Image,this.image.src=this.dir,this.current=1,this.size={width:24,height:24},this.level=[],this.levelSolid=[],this.levelGrid=null,this.finder=new PF.AStarFinder({allowDiagonal:!0,dontCrossCorners:!0}),this.levelBodies=[{model:"Teleport",params:{view:{x:315,y:57},pairId:"A"}},{model:"Teleport",params:{view:{x:348,y:574},pairId:"A"}},{model:"BonusHealth",params:{view:{x:360,y:267},collider:{r:5}}},{model:"BonusFireRate",params:{view:{x:477,y:366},collider:{r:5}}},{model:"Spawn",params:{view:{x:63,y:312},populationModel:"BonusSpeedUp"}},{model:"Spawn",params:{view:{x:700,y:160},populationModel:"Asteroid",populationParams:{target:this.game.player}}},{model:"Spawn",params:{view:{x:50,y:670},populationModel:"Asteroid",populationParams:{target:this.game.player}}}],this.loadLevel("1")}return _createClass(e,[{key:"render",value:function(){this.game.screen.fillStyle="#161318",this.game.screen.fillRect(0-this.game.camera.x,0-this.game.camera.y,this.game.world.width,this.game.world.height);for(var e=0;e<this.level.length;e++)this.draw(this.level[e]);if(this.game.builder)for(var e=0;e<this.levelSolid.length;e++)this.game.screen.beginPath(),this.game.screen.fillStyle="rgba(255, 0, 0, 0.3)",this.game.screen.fillRect(this.levelSolid[e].x+2-this.game.camera.x,this.levelSolid[e].y+2-this.game.camera.y,this.levelSolid[e].width-4,this.levelSolid[e].height-4),this.game.screen.stroke();this.game.debug&&this.renderSolid()}},{key:"renderSolid",value:function(){for(var e=0;e<this.levelSolid.length;e++){var t=this.levelSolid[e];if(this.game.screen.fillStyle="rgba(255, 0, 0, 0.3)",t instanceof SAT.Box)this.game.screen.fillRect(t.pos.x-this.game.camera.x+1,t.pos.y-this.game.camera.y+1,t.w-2,t.h-2);else if(t instanceof SAT.Polygon){this.game.screen.beginPath(),this.game.screen.moveTo(t.points[0].x-this.game.camera.x,t.points[0].y-this.game.camera.y);for(var i=1;i<t.points.length;i++)this.game.screen.lineTo(t.points[i].x-this.game.camera.x,t.points[i].y-this.game.camera.y);this.game.screen.lineTo(t.points[t.points.length-1].x-this.game.camera.x,t.points[t.points.length-1].y-this.game.camera.y),this.game.screen.stroke()}}}},{key:"draw",value:function(e){e.x+this.size.width>this.game.camera.x&&e.x<this.game.camera.x+this.game.camera.width&&e.y+this.size.height>this.game.camera.y&&e.y<this.game.camera.y+this.game.camera.height&&this.game.screen.drawImage(this.image,e.sx,e.sy,this.size.width,this.size.height,e.x-this.game.camera.x,e.y-this.game.camera.y,this.size.width,this.size.height)}},{key:"build",value:function(e){this.level.push(e)}},{key:"clean",value:function(){for(var e,t=0;t<this.level.length;t++){e=this.level[t];for(var i,n=0;n<this.level.length;n++)if(i=this.level[n],e!=i&&e.x===i.x&&e.y===i.y){this.level.splice(t,1),t--;break}}}},{key:"remove",value:function(e,t){for(var i=0;i<this.level.length;i++)if(this.level[i].x===e&&this.level[i].y===t){this.level.splice(i,1);break}}},{key:"loadLevel",value:function(e){var t=new XMLHttpRequest,i=this;t.overrideMimeType("application/json"),t.open("GET","levels/level_"+e+".json",!0),t.onreadystatechange=function(){if(4==t.readyState&&"200"==t.status){var e=JSON.parse(t.responseText);i.levelGrid=new PF.Grid(i.game.world.width/i.size.width,i.game.world.height/i.size.height);for(var n=0;n<e.tiles.length;n++)i.level.push(e.tiles[n]);for(var s=0;s<e.solids.length;s++){var a=e.solids[s];i.addSolid(a.x,a.y,a.w,a.h),i.levelGrid.setWalkableAt(a.x/i.size.width,a.y/i.size.height,!1)}for(var r=0;r<i.levelBodies.length;r++){var o=i.game.evalBody(i.levelBodies[r].model,i.levelBodies[r].params);i.game.addBody(o)}}},t.send(null)}},{key:"logLevel",value:function(){console.log(JSON.stringify(this.level)),console.log("=============================="),console.log(JSON.stringify(this.levelSolida.map(function(e){return{x:e.pos.x,y:e.pos.y,w:e.w,h:e.h}})))}},{key:"addSolid",value:function(e,t,i,n){this.levelSolid.push(new SAT.Box(new SAT.Vector(e,t),i,n))}},{key:"simplifySolid",value:function(){this.levelSolid=this.levelSolid.map(function(e){return e.toPolygon()});for(var e=0;e<this.levelSolid.length;e++)for(var t=this.levelSolid[e],i=new SAT.Response,n=0;n<this.levelSolid.length;n++)if(t!=this.levelSolid){i.clear();var s=SAT.testPolygonPolygon(t,this.levelSolid[n],i);s&&(this.levelSolid[e]=new SAT.Polygon(new SAT.Vector(t.pos.x,t.pos.y),t.points.concat(this.levelSolid[n].points)),this.levelSolid.splice(n,1))}}},{key:"simplifySolid__old",value:function(){console.log("before simplify",this.levelSolid.length);for(var e,t=0;t<this.levelSolid.length;t++)if(e=this.levelSolid[t]){for(var i,n=!1,s=0;s<this.levelSolid.length;s++)i=this.levelSolid[s],i&&e!=i&&e.x<=i.x+i.width&&e.x+e.width>=i.x&&e.y<=i.y+i.height&&e.height+e.y>=i.y&&(e.x===i.x&&e.width===i.width||e.y===i.y&&e.height===i.height)&&(i.x<e.x?(e.x-=i.width,e.width+=i.width):i.x>e.x?e.width+=i.width:i.y<e.y?(e.y-=i.height,e.height+=i.height):i.y>e.y&&(e.height+=i.height),n=!0,delete this.levelSolid[s]);n&&t--}this.levelSolid=this.levelSolid.filter(function(e){return!!e})}},{key:"path",value:function(e,t){var i=this;return this.levelGrid?this.finder.findPath(this.normalizeForPath(e.view.cx),this.normalizeForPath(e.view.cy),this.normalizeForPath(t.view.cx),this.normalizeForPath(t.view.cy),this.levelGrid.clone()).map(function(e){return{x:e[0]*i.size.width+i.size.width/2,y:e[1]*i.size.height+i.size.height/2}}):[]}},{key:"normalizeForPath",value:function(e){return(e-e%this.size.width)/this.size.width}}]),e}(),_createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),Teleport=function(e){function t(e,i){_classCallCheck(this,t),i=i||{};var n=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e,i));return n.pairId=i.pairId||Math.random(),n.active=!0,n.animation.name="teleport",n.view.width=52,n.view.height=52,n.collider={r:5},n.createCollider(),n}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){this.game.sprite.draw(this,this.lookAngel)}},{key:"onEnter",value:function(e,i){var n=this;if(this.active){var s=this.game.bodies.find(function(e){return e instanceof t&&e!==n&&e.pairId===n.pairId});s.active=!1,e.teleport(s.view.x,s.view.y)}}},{key:"onLeave",value:function(e){this.active=!0}}]),t}(Basis),_createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),BonusFireRate=function(e){function t(e,i){_classCallCheck(this,t);var n=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e,i));return n.title="Firerate",n.time=2e3,n.effect={shooting:{rate:3}},n.animation.name="bonusFire",n}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){this.game.sprite.draw(this,this.lookAngel)}}]),t}(Bonus),_createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),BonusHealth=function(e){function t(e,i){_classCallCheck(this,t);var n=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e,i));return n.title="Health",n.permanent=!0,n.effect={health:{current:20}},n.animation.name="bonusHealth",n}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){this.game.sprite.draw(this,this.lookAngel)}},{key:"canApply",value:function(e){return e.health.current<e.health.max}}]),t}(Bonus),_createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),BonusSpeedUp=function(e){function t(e,i){_classCallCheck(this,t);var n=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e,i));return n.title="SpeedUp",n.time=5e3,n.effect={speed:2},n.animation.name="bonusSpeed",n}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){this.game.sprite.draw(this,this.lookAngel)}}]),t}(Bonus);