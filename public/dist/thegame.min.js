"use strict";function _classCallCheck(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(i,t){if(!i)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?i:t}function _inherits(i,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);i.prototype=Object.create(t&&t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(i,t):i.__proto__=t)}function _classCallCheck(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(i,t){if(!i)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?i:t}function _inherits(i,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);i.prototype=Object.create(t&&t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(i,t):i.__proto__=t)}function _classCallCheck(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(i,t){if(!i)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?i:t}function _inherits(i,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);i.prototype=Object.create(t&&t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(i,t):i.__proto__=t)}function _classCallCheck(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function i(i,t){for(var e=0;e<t.length;e++){var s=t[e];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(i,s.key,s)}}return function(t,e,s){return e&&i(t.prototype,e),s&&i(t,s),t}}(),Basis=function(){function i(t){_classCallCheck(this,i),this.game=t,this.size={width:16,height:16,radius:16},this.position={x:0,y:0},this.direction={x:0,y:0},this.look={x:0,y:0},this.lookAngel=0,this.speed=0,this.velocity=0,this.gravity=.5,this.animation={name:null,state:"stand",keyframe:0,rate:5,end:!1},this.health={max:100,current:100},this.attack={damageMin:1,damageMax:2,range:0},this.willDie=!1,this.willAttack=!1,this.rotationSpeed=.05,this.density=0}return _createClass(i,[{key:"render",value:function(){this.game.screen.beginPath(),this.game.screen.rect(this.position.x-this.game.camera.x,this.position.y-this.game.camera.y,this.size.width,this.size.height),this.game.screen.stroke()}},{key:"healthBar",value:function t(){var t={x:this.position.x-this.game.camera.x,y:this.position.y-this.game.camera.y-5,height:3,width:this.size.width*(this.health.current/this.health.max)};this.game.screen.beginPath(),this.game.screen.rect(t.x,t.y,this.size.width,t.height),this.game.screen.fillStyle="red",this.game.screen.fillRect(t.x,t.y,t.width,t.height),this.game.screen.stroke()}},{key:"update",value:function(){}},{key:"colliding",value:function(i,t){var e=i.x-t.x,s=i.y-t.y,a=Math.sqrt(e*e+s*s);return a<i.r+t.r}},{key:"collidingSqr",value:function(i){return!(this.position.x+this.size.width<=i.position.x||this.position.y+this.size.height<=i.position.y||this.position.x>=i.position.x+i.size.width||this.position.y>=i.position.y+i.size.height)}},{key:"collidingBody",value:function(i){return this!=i&&this.colliding({x:this.position.x,y:this.position.y,r:this.size.width/2},{x:i.position.x,y:i.position.y,r:i.size.width/2})}},{key:"brotherColliding",value:function(){for(var i,t=this.constructor,e=0;e<this.game.bodies.length;e++)if(i=this.game.bodies[e],i instanceof t&&this.collidingBody(i)){if(this.position.x<i.position.x){var s=(this.position.x+this.size.width-i.position.x)/2*i.density;this.position.x-=s,i.position.x+=s}else if(this.position.x>i.position.x){var s=(i.position.x-this.position.x+this.size.width)/2*i.density;this.position.x+=s,i.position.x-=s}if(this.position.y<i.position.y){var s=(this.position.y+this.size.height-i.position.y)/2*i.density;this.position.y-=s,i.position.y+=s}else if(this.position.y>i.position.y){var s=(i.position.y-this.position.y+this.size.height)/2*i.density;this.position.y+=s,i.position.y-=s}}}},{key:"isOuterCamera",value:function(){return!this.collidingSqr(this)}},{key:"fixStuckWorld",value:function(){this.position.x<0?(this.position.x=0,this.direction.x<0&&(this.direction.x=-this.direction.x)):this.position.x+this.size.width>this.game.world.width&&(this.position.x=this.game.world.width-this.size.width,this.direction.x>0&&(this.direction.x=-this.direction.x)),this.position.y<0?(this.position.y=0,this.direction.y<0&&(this.direction.y=-this.direction.y)):this.position.y+this.size.height>this.game.world.height&&(this.position.y=this.game.world.height-this.size.height,this.direction.y>0&&(this.direction.y=-this.direction.y))}},{key:"directionTo",value:function(i){var t=i.position.x+i.size.width/2-(this.position.x+this.size.width/2),e=i.position.y+i.size.height/2-(this.position.y+this.size.height/2),s=Math.sqrt(t*t+e*e);return{x:t/s,y:e/s}}},{key:"vectorAngle",value:function(i,t){Math.atan2(t.y-i.y,t.x-i.x);return 180*Math.atan2(t.y-i.y,t.x-i.x)/Math.PI}},{key:"getRandomInt",value:function(i,t){return Math.floor(Math.random()*(t-i+1))+i}},{key:"changeAnimation",value:function(i){this.animation.state!=i&&(this.animation.state=i,this.animation.keyframe=0,this.animation.end=!1)}},{key:"kill",value:function(){this.willDie=!0,this.changeAnimation("die")}},{key:"hit",value:function(i){this.health.current-=i,this.health.current<=0&&(this.health.current=0,this.kill())}},{key:"isReach",value:function(i){return this!=i&&this.colliding({x:this.position.x,y:this.position.y,r:this.size.width/2},{x:i.position.x,y:i.position.y,r:this.attack.range+this.size.width/2})}},{key:"faceBarrier",value:function(i){for(var t,e=0;e<this.game.stage.levelSolid.length;e++){t={position:{x:this.game.stage.levelSolid[e].x,y:this.game.stage.levelSolid[e].y},size:{width:this.game.stage.size.width,height:this.game.stage.size.height}};var s=!1;if(this.collidingSqr(t)){var a=this.directionTo(t),o=this.size.width/2+t.size.width/2;this.position.x+=-a.x*o*.1,this.position.y+=-a.y*o*.1,s=!0}i&&s&&(this.position.x<t.position.x&&this.direction.x>0||this.position.x>t.position.x&&this.direction.x<0?this.direction.x=-this.direction.x:(this.position.y<t.position.y&&this.direction.y>0||this.position.y>t.position.y&&this.direction.y<0)&&(this.direction.y=-this.direction.y))}}}]),i}(),_createClass=function(){function i(i,t){for(var e=0;e<t.length;e++){var s=t[e];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(i,s.key,s)}}return function(t,e,s){return e&&i(t.prototype,e),s&&i(t,s),t}}(),Asteroid=function(i){function t(i,e){_classCallCheck(this,t);var s=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,i));return s.size={width:e.width,height:e.height},s.position={x:e.x||Math.floor(Math.random()*(s.game.world.width-s.size.width)),y:e.y||Math.floor(Math.random()*(s.game.world.height-s.size.height))},s.direction={x:Math.random(),y:Math.random()},s.attack.range=5,s.speed=2*Math.random(),s.speed=3,s.animation.name="monster",s.target=e.target||null,s.density=.03,s}return _inherits(t,i),_createClass(t,[{key:"render",value:function(){this.game.screen.beginPath(),this.game.screen.arc(this.position.x+this.size.width/2-this.game.camera.x,this.position.y+this.size.height/2-this.game.camera.y,(this.size.width+this.size.height)/6,0,2*Math.PI),this.game.screen.fillStyle="rgba(0,0,0,0.2)",this.game.screen.fill();var i=this.vectorAngle({x:this.position.x-this.game.camera.x,y:this.position.y-this.game.camera.y},{x:this.position.x-this.game.camera.x+this.look.x,y:this.position.y-this.game.camera.y+this.look.y});this.game.sprite.draw(this,i),this.healthBar()}},{key:"update",value:function(){this.brotherColliding(),this.willDie||(this.willAttack||this.isReach(this.target)?(this.willAttack=!0,this.changeAnimation("attack"),this.animation.end&&(this.willAttack=!1,this.isReach(this.target)&&(console.log("hit you"),this.target.hit(this.getRandomInt(this.attack.damageMin,this.attack.damageMax))),this.changeAnimation("stand"))):this.speed?(this.target&&this.routeToTarget(),this.changeAnimation("walk"),this.faceBarrier(),this.position.x+=this.direction.x*this.speed,this.position.y+=this.direction.y*this.speed):this.changeAnimation("stand"))}},{key:"routeToTarget",value:function(){var i=this.directionTo({position:{x:this.target.position.x,y:this.target.position.y},size:{width:this.size.width,height:this.size.height}});this.direction.x+=(i.x-this.direction.x)*this.rotationSpeed,this.direction.y+=(i.y-this.direction.y)*this.rotationSpeed,this.look.x+=(i.x-this.look.x)*this.rotationSpeed,this.look.y+=(i.y-this.look.y)*this.rotationSpeed}}]),t}(Basis),_createClass=function(){function i(i,t){for(var e=0;e<t.length;e++){var s=t[e];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(i,s.key,s)}}return function(t,e,s){return e&&i(t.prototype,e),s&&i(t,s),t}}(),Builder=function(){function i(t){_classCallCheck(this,i),this.game=t,this.size={width:24,height:24},this.position={x:0,y:0,sx:0,sy:0},this.speed=3,this.material=""}return _createClass(i,[{key:"update",value:function(){this.position.sx=this.game.point.x+this.game.camera.x-(this.game.point.x+this.game.camera.x)%this.size.width,this.position.sy=this.game.point.y+this.game.camera.y-(this.game.point.y+this.game.camera.y)%this.size.width,this.move()}},{key:"render",value:function(){this.game.screen.beginPath(),this.game.screen.rect(this.position.sx-this.game.camera.x,this.position.sy-this.game.camera.y,this.size.width,this.size.height),this.game.screen.stroke()}},{key:"move",value:function(){var i=this.position.sx,t=this.position.sy;this.game.keyboard.isPressed("A")?this.position.x-=this.speed:this.game.keyboard.isPressed("D")&&(this.position.x+=this.speed),this.game.keyboard.isPressed("W")?this.position.y-=this.speed:this.game.keyboard.isPressed("S")&&(this.position.y+=this.speed),this.game.keyboard.isPressed("F")&&(this.game.keyboard.isPressed("1")?this.material="wall_1":this.game.keyboard.isPressed("2")?this.material="wall_2":this.game.keyboard.isPressed("3")?this.material="wall_3":this.game.keyboard.isPressed("4")?this.material="wall_4":this.game.keyboard.isPressed("5")?this.material="wall_5":this.game.keyboard.isPressed("6")?this.material="wall_6":this.game.keyboard.isPressed("7")?this.material="wall_7":this.game.keyboard.isPressed("8")?this.material="wall_8":this.game.keyboard.isPressed("9")&&(this.material="wall_9")),this.game.keyboard.isPressed("G")&&(this.game.keyboard.isPressed("1")?this.material="wall_10":this.game.keyboard.isPressed("2")?this.material="wall_11":this.game.keyboard.isPressed("3")?this.material="wall_12":this.game.keyboard.isPressed("4")?this.material="wall_13":this.game.keyboard.isPressed("5")?this.material="wall_14":this.game.keyboard.isPressed("6")&&(this.material="wall_15")),this.game.keyboard.isPressed("C")&&this.game.stage.clean(),this.game.point.isPressed("LEFT")&&this.game.stage.build([this.material,i,t])}}]),i}(),_createClass=function(){function i(i,t){for(var e=0;e<t.length;e++){var s=t[e];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(i,s.key,s)}}return function(t,e,s){return e&&i(t.prototype,e),s&&i(t,s),t}}(),Bullet=function(i){function t(i,e,s){_classCallCheck(this,t);var a=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,i));return a.size.width=24,a.size.height=24,a.position.x=e.x-a.size.width/2,a.position.y=e.y-a.size.height/2,a.direction=e.direction,a.speed=5,a.animation.name="bullet",a.attack.damage=e.damage,a.owner=s,a}return _inherits(t,i),_createClass(t,[{key:"update",value:function(){this.isOuterCamera()&&this.game.removeBody(this);for(var i,t=0;t<this.game.bodies.length;t++)i=this.game.bodies[t],this.willDie||i.willDie||this.owner===i||!this.collidingBody(i)||(this.kill(),this.speed=0,i.hit(this.attack.damage));this.position.x+=this.direction.x*this.speed,this.position.y+=this.direction.y*this.speed,this.faceBarrier(!0)}},{key:"render",value:function(){var i=this.vectorAngle({x:this.position.x-this.game.camera.x,y:this.position.y-this.game.camera.y},{x:this.position.x-this.game.camera.x+this.direction.x*this.speed,y:this.position.y-this.game.camera.y+this.direction.y*this.speed});this.game.sprite.draw(this,i)}}]),t}(Basis),_createClass=function(){function i(i,t){for(var e=0;e<t.length;e++){var s=t[e];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(i,s.key,s)}}return function(t,e,s){return e&&i(t.prototype,e),s&&i(t,s),t}}(),Game=function(){function i(){_classCallCheck(this,i);var t=this;this.editMode=!1,this.canvas=document.createElement("canvas"),document.body.appendChild(this.canvas),this.canvas.width=document.body.offsetWidth-10,this.canvas.height=document.body.offsetHeight-10,this.screen=this.canvas.getContext("2d"),this.screen.imageSmoothingEnabled=!1,this.camera={x:0,y:0,width:this.canvas.width,height:this.canvas.height,target:null},this.world={width:600,height:600},this.player=new Player(t),this.playerControl=new PlayerControl(t),this.socket=new Socket(t),this.builder=null,this.keyboard=new Keyboard,this.point=new Point(t.canvas),this.sprite=new Sprite(t),this.stage=new Stage(t),this.lastTick=new Date,this.timer=0,this.camera.target=this.player,this.bodies=[],this.addBody(this.player);for(var e=0;0>e;e++)t.addBody(new Asteroid(t,{target:t.player,width:48,height:48}));var s=function a(){t.update(),t.render(),requestAnimationFrame(a)};s(),this.modeToggler()}return _createClass(i,[{key:"render",value:function(){this.screen.clearRect(0,0,this.camera.width,this.camera.height);var i=new Date,t=Math.round(1e3/(i-this.lastTick));this.lastTick=i,this.stage.render(),this.debug(["FPS: "+t,"Obj count: "+this.bodies.length,"Stage count: "+this.stage.level.length,"Camera (x: "+this.camera.x.toFixed()+", y: "+this.camera.y.toFixed()+")","Player (x: "+this.player.position.x.toFixed()+", y: "+this.player.position.y.toFixed()+")","Player dir(x: "+this.player.direction.x+", y: "+this.player.direction.y+")"]),this.screen.rect(0-this.camera.x,0-this.camera.y,this.world.width,this.world.height),this.screen.stroke();for(var e,s=0;s<this.bodies.length;s++)e=this.bodies[s],this.isCameraShow(this.bodies[s])&&e.render()}},{key:"update",value:function(){this.timer++,this.camera.x=this.camera.target.position.x-this.camera.width/2+this.camera.target.size.width/2,this.camera.y=this.camera.target.position.y-this.camera.height/2+this.camera.target.size.height/2,this.camera.x+=.2*(this.point.x-this.camera.width/2),this.camera.y+=.2*(this.point.y-this.camera.height/2),this.playerControl.update();for(var i,t=0;t<this.bodies.length;t++)i=this.bodies[t],i.willDie&&i.animation.end?(this.removeBody(i),t--):i.update()}},{key:"addBody",value:function(i){this.bodies.push(i)}},{key:"removeBody",value:function(i){Array.isArray(i)||(i=[i]);for(var t=0;t<i.length;t++)for(var e=0;e<this.bodies.length;e++)i[t]==this.bodies[e]&&(this.bodies.splice(e,1),e--)}},{key:"debug",value:function(i){this.screen.fillStyle="#000";for(var t=0;t<i.length;t++)this.screen.fillText(i[t],10,18*(t+1));this.screen.fillText("W",40,this.camera.height-40),this.screen.fillText("S",40,this.camera.height-20),this.screen.fillText("A",20,this.camera.height-20),this.screen.fillText("D",60,this.camera.height-20),this.screen.beginPath(),this.screen.moveTo(35,this.camera.height-55),this.screen.lineTo(55,this.camera.height-55),this.screen.lineTo(55,this.camera.height-35),this.screen.lineTo(75,this.camera.height-35),this.screen.lineTo(75,this.camera.height-15),this.screen.lineTo(15,this.camera.height-15),this.screen.lineTo(15,this.camera.height-35),this.screen.lineTo(35,this.camera.height-35),this.screen.lineTo(35,this.camera.height-55),this.screen.stroke()}},{key:"isCameraShow",value:function(i){return!(i.position.x+i.size.width<this.camera.x&&i.position.x>this.camera.width&&i.position.y+i.size.height<this.camera.y&&i.position.y>this.camera.width)}},{key:"modeToggler",value:function(){var i=this;document.addEventListener("keydown",function(t){113==t.keyCode&&(i.builder=new Builder(i),i.camera.target=i.builder,i.bodies=[],i.addBody(i.builder))})}}]),i}(),Keyboard=function i(){_classCallCheck(this,i);var t={},e={SPACE:32,A:65,W:87,D:68,S:83,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,F:70,G:71,H:72,C:67,F2:113,LEFT:37,UP:38,RIGHT:39,DOWN:40};document.addEventListener("keydown",function(i){i.preventDefault(),t[i.keyCode]=!0}),document.addEventListener("keyup",function(i){t[i.keyCode]=!1}),this.isPressed=function(i){return i=i.toUpperCase(),t[e[i]]}},_createClass=function(){function i(i,t){for(var e=0;e<t.length;e++){var s=t[e];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(i,s.key,s)}}return function(t,e,s){return e&&i(t.prototype,e),s&&i(t,s),t}}(),Player=function(i){function t(i,e){_classCallCheck(this,t),e=e||{};var s=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,i));return s.speed=3,s.size.width=48,s.size.height=48,s.position.x=e.x||i.world.width/2-s.size.width/2,s.position.y=e.y||i.world.height/2-s.size.height/2,s.shooting={start:!1,bullet:1,rate:3,reload:0},s.attack={damageMin:20,damageMax:50,range:10},s.animation.name="player",s}return _inherits(t,i),_createClass(t,[{key:"render",value:function(){this.game.screen.beginPath(),this.game.screen.arc(this.position.x+this.size.width/2-this.game.camera.x,this.position.y+this.size.height/2-this.game.camera.y,(this.size.width+this.size.height)/6,0,2*Math.PI),this.game.screen.fillStyle="rgba(0,0,0,0.2)",this.game.screen.fill(),this.game.sprite.draw(this,this.lookAngel),this.healthBar()}},{key:"update",value:function(){this.shot(),this.move()}},{key:"move",value:function(){this.faceBarrier(),this.position.x+=this.direction.x*this.speed,this.position.y+=this.direction.y*this.speed,this.direction.x||this.direction.y?this.changeAnimation("walk"):this.changeAnimation("stand")}},{key:"shot",value:function(){if(!this.shooting.bullet&&++this.shooting.reload>=60/this.shooting.rate&&(this.shooting.bullet=1,this.shooting.reload=0),this.shooting.bullet&&this.shooting.start){this.shooting.bullet=0;var i={x:this.position.x+this.size.width/2,y:this.position.y+this.size.height/2,direction:this.directionTo({position:{x:this.game.point.x+this.game.camera.x,y:this.game.point.y+this.game.camera.y},size:{width:0,height:0}}),damage:this.getRandomInt(this.attack.damageMin,this.attack.damageMax)};this.game.addBody(new Bullet(this.game,i,this.game.player)),this.game.socket.shot(i)}}}]),t}(Basis),_createClass=function(){function i(i,t){for(var e=0;e<t.length;e++){var s=t[e];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(i,s.key,s)}}return function(t,e,s){return e&&i(t.prototype,e),s&&i(t,s),t}}(),PlayerControl=function(){function i(t){_classCallCheck(this,i),this.game=t}return _createClass(i,[{key:"update",value:function(){var i=this.game.player.lookAngel;this.move(),this.shot(),this.rotate(),(this.game.player.direction.x||this.game.player.direction.y||i!==this.game.player.lookAngel)&&this.game.socket.move(this.game.player)}},{key:"move",value:function(){var i=this.game.player;i.direction.x=0,i.direction.y=0,this.game.keyboard.isPressed("A")?i.direction.x=-1:this.game.keyboard.isPressed("D")&&(i.direction.x=1),this.game.keyboard.isPressed("W")?i.direction.y=-1:this.game.keyboard.isPressed("S")&&(i.direction.y=1)}},{key:"shot",value:function(){this.game.player.shooting.start=this.game.point.isPressed("LEFT")||this.game.keyboard.isPressed("SPACE")}},{key:"rotate",value:function(){this.game.player.lookAngel=this.game.player.vectorAngle({x:this.game.player.position.x-this.game.camera.x+this.game.player.size.width/2,y:this.game.player.position.y-this.game.camera.y+this.game.player.size.width/2},{x:this.game.point.x,y:this.game.point.y})}}]),i}(),Point=function t(i){_classCallCheck(this,t);var e=this,s={},a={LEFT:0,RIGHT:2,MIDDLE:1};this.x=0,this.y=0,i.addEventListener("mousemove",function(i){e.x=i.clientX,e.y=i.clientY}),i.addEventListener("mousedown",function(i){s[i.button]=!0}),i.addEventListener("mouseup",function(i){i.preventDefault(),s[i.button]=!1}),this.isPressed=function(i){return i=i.toUpperCase(),s[a[i]]}},_createClass=function(){function i(i,t){for(var e=0;e<t.length;e++){var s=t[e];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(i,s.key,s)}}return function(t,e,s){return e&&i(t.prototype,e),s&&i(t,s),t}}(),Socket=function(){function i(t){function e(i){t.player.id=i.socketId;for(var e=0;e<i.game.length;e++)i.socketId===i.game[e].socketId?t.player.position=i.game[e].position:o(i.game[e])}function s(i){l[i.socketId].willDie=!0,delete l[i.socketId]}function a(i){l[i.socketId]||o(i),l[i.socketId].position=i.position,l[i.socketId].lookAngel=i.lookAngel}function o(i){var e=new Player(t,i.position);l[i.socketId]=e,l[i.socketId].id=i.socketId,l[i.socketId].lookAngel=i.lookAngel,t.bodies.push(e)}function n(i){t.addBody(new Bullet(t,i.bullet,l[i.socketId]))}function h(i){l[i.socketId].kill()}_classCallCheck(this,i);var r=io.connect("http://localhost:8080");this.socket=r;var l={};r.on("connected",e),r.on("leave",s),r.on("move",a),r.on("join",o),r.on("bullet",n),r.on("kill",h)}return _createClass(i,[{key:"move",value:function(i){this.socket.emit("move",{position:i.position,lookAngel:i.lookAngel})}},{key:"shot",value:function(i){this.socket.emit("bullet",i)}},{key:"kill",value:function(i){this.socket.emit("kill",i)}}]),i}(),_createClass=function(){function i(i,t){for(var e=0;e<t.length;e++){var s=t[e];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(i,s.key,s)}}return function(t,e,s){return e&&i(t.prototype,e),s&&i(t,s),t}}(),Sprite=function(){function i(t){_classCallCheck(this,i),this.game=t,this.dir="/sprites/sprite.png",this.image=new Image,this.image.src=this.dir,this.size={width:48,height:48},this.collection={player:{stand:[{x:0,y:0}],walk:[{x:0,y:0},{x:48,y:0},{x:96,y:0},{x:144,y:0},{x:0,y:48},{x:48,y:48},{x:96,y:48},{x:144,y:48}],die:[{x:0,y:336},{x:0,y:336},{x:48,y:336},{x:48,y:336}]},monster:{stand:[{x:0,y:144}],walk:[{x:0,y:144},{x:48,y:144},{x:96,y:144},{x:144,y:144},{x:0,y:192},{x:48,y:192},{x:96,y:192},{x:144,y:192}],bite:[{x:0,y:240},{x:48,y:240},{x:96,y:240}],attack:[{x:0,y:288},{x:48,y:288},{x:96,y:288},{x:144,y:288},{x:192,y:288}],die:[{x:0,y:336},{x:0,y:336},{x:48,y:336},{x:48,y:336}]},bullet:{stand:[{x:0,y:96,w:24,h:24}],die:[{x:0,y:120,w:24,h:24},{x:24,y:120,w:24,h:24}]}}}return _createClass(i,[{key:"draw",value:function(i,t){var e=i.position.x+i.size.width/2-this.game.camera.x,s=i.position.y+i.size.height/2-this.game.camera.y;t-=90;var a=this.getFrame(i.animation);this.game.screen.save(),this.game.screen.translate(e,s),this.game.screen.rotate(t*Math.PI/180),this.game.screen.drawImage(this.image,a.x,a.y,a.w||this.size.width,a.h||this.size.height,-i.size.width/2,-i.size.width/2,i.size.width,i.size.height),this.game.screen.translate(-e,-s),this.game.screen.rotate(-t*Math.PI/180),this.game.screen.restore()}},{key:"getFrame",value:function(i){var t=this.collection[i.name][i.state];return this.game.timer%i.rate==0&&(t.length-1>i.keyframe?i.keyframe+=1:(i.keyframe=0,i.end=!0)),t[i.keyframe]}}]),i}(),_createClass=function(){function i(i,t){for(var e=0;e<t.length;e++){var s=t[e];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(i,s.key,s)}}return function(t,e,s){return e&&i(t.prototype,e),s&&i(t,s),t}}(),Stage=function(){function i(t){_classCallCheck(this,i);this.game=t,this.dir="/sprites/tileset.png",this.image=new Image,this.image.src=this.dir,this.current=1,this.size={width:24,height:24},this.cleaned=!0,this.level=[],this.levelSolid=[];for(var e=0;e<this.game.world.width;e+=this.size.width)for(var s=0;s<this.game.world.height;s+=this.size.height)0===e?this.build(["wall_4",e,s]):0===s?this.build(["wall_2",e,s]):e===this.game.world.width-this.size.width?this.build(["wall_6",e,s]):s===this.game.world.height-this.size.height?this.build(["wall_8",e,s]):this.build(["wall_5",e,s]);this.build(["wall_1",0,0]),this.build(["wall_3",this.game.world.width-this.size.width,0]),this.build(["wall_7",0,this.game.world.height-this.size.height]),this.build(["wall_9",this.game.world.width-this.size.width,this.game.world.height-this.size.height]),this.build(["wall_10",288,120]),this.build(["wall_11",288,144]),this.build(["wall_11",288,168]),this.build(["wall_11",288,192]),this.build(["wall_11",288,216]),this.build(["wall_12",288,240]),this.build(["wall_13",288,336]),this.build(["wall_14",312,336]),this.build(["wall_14",336,336]),this.build(["wall_15",360,336])}return _createClass(i,[{key:"render",value:function(){for(var i=0;i<this.level.length;i++)this.draw(this.level[i])}},{key:"draw",value:function(i){i.x+this.size.width>this.game.camera.x&&i.x<this.game.camera.x+this.game.camera.width&&i.y+this.size.height>this.game.camera.y&&i.y<this.game.camera.y+this.game.camera.height&&this.game.screen.drawImage(this.image,i.sx,i.sy,this.size.width,this.size.height,i.x-this.game.camera.x,i.y-this.game.camera.y,this.size.width,this.size.height)}},{key:"build",value:function(i){var t={x:i[1],y:i[2]};switch(i[0]){case"floor_1":t.sx=0,t.sy=72;break;case"floor_2":t.sx=24,t.sy=72;break;case"floor_3":t.sx=48,t.sy=72;break;case"floor_4":t.sx=0,t.sy=96;break;case"floor_5":t.sx=24,t.sy=96;break;case"floor_6":t.sx=48,t.sy=96;break;case"floor_7":t.sx=0,t.sy=120;break;case"floor_8":t.sx=24,t.sy=120;break;case"floor_9":t.sx=48,t.sy=120;break;case"wall_1":t.sx=0,t.sy=144,t.solid=!0;break;case"wall_2":t.sx=24,t.sy=144,t.solid=!0;break;case"wall_3":t.sx=48,t.sy=144,t.solid=!0;break;case"wall_4":t.sx=0,t.sy=168,t.solid=!0;break;case"wall_5":t.sx=24,t.sy=168;break;case"wall_6":t.sx=48,t.sy=168,t.solid=!0;break;case"wall_7":t.sx=0,t.sy=192,t.solid=!0;break;case"wall_8":t.sx=24,t.sy=192,t.solid=!0;break;case"wall_9":t.sx=48,t.sy=192,t.solid=!0;break;case"wall_10":t.sx=72,t.sy=144,t.solid=!0;break;case"wall_11":t.sx=72,t.sy=168,t.solid=!0;break;case"wall_12":t.sx=72,t.sy=192,t.solid=!0;break;case"wall_13":t.sx=96,t.sy=192,t.solid=!0;break;case"wall_14":t.sx=120,t.sy=192,t.solid=!0;break;case"wall_15":t.sx=144,t.sy=192,t.solid=!0}this.cleaned=!1,this.level.push(t),t.solid&&this.levelSolid.push(t)}},{key:"clean",value:function(){if(!this.cleaned){for(var i,t=0;t<this.level.length;t++){i=this.level[t];for(var e,s=0;s<this.level.length;s++)if(e=this.level[s],i!=e&&i.x===e.x&&i.y===e.y){this.level.splice(t,1),t--;break}}this.cleaned=!0}}}]),i}(),Vector=function e(i,t){_classCallCheck(this,e),this.x=i,this.y=t};